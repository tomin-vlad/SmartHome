<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="milligram.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <title>Smart Home</title>
  </head>
  <body>
    <div class="cover-container">
      <main class="main">
        <div class="row">
          <div class="column">
            <div class="card">
              <div class="card-body">
                <img src="thermometer.svg" width="70" height="70" alt="thermometer">
                <h2 class="title"><span id="temperature">NaN</span><sup>&deg;</sup>C</h2>
                <p class="subtitle">Влажность: <span id="humidity">NaN</span>%</p>
              </div>
            </div>
          </div>
          <div class="column">
            <div class="card">
              <div class="card-body">
                <img src="toggle-off.svg" id="relay_img" width="70" height="70" alt="toggle">
                <h2 class="title">Реле</h2>
                <p class="subtitle">Статус: <span id="relay_state">выключено</span></p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      setInterval(function(){
        var request = new XMLHttpRequest();
        // Получение и отображение данных о температуре и влажности
        request.open('GET', '/temperature', true);
        request.onload = function() {
          if (request.readyState === 4 && request.status === 200) {
            var response = request.responseText.split('|');

            var temperature = document.querySelector('#temperature');
            temperature.textContent = parseFloat(response[0]).toFixed(1);

            var humidity = document.querySelector('#humidity');
            humidity.textContent = Math.round(response[1]);
          }
        }
        request.send();

        // Получение и отображение данных о состоянии реле
        var request2 = new XMLHttpRequest();
        request2.open('GET', '/relay_status', true);
        request2.onload = function() {
          if (request2.readyState === 4 && request2.status === 200) {
            var response2 = request2.responseText;
            var relay_img = document.querySelector('#relay_img');
            var relay_state = document.querySelector('#relay_state');

            if (response2 == 1) {
              relay_img.setAttribute('src', 'toggle-on.svg');
              relay_state.textContent = 'включено';
            } else {
              relay_img.setAttribute('src', 'toggle-off.svg');
              relay_state.textContent = 'выключено';
            }
          }
        }
        request2.send();
      }, 1000);
    </script>
  </body>
</html>
